<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <title>MagnetDownloader - Fast & Secure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Download files from magnet links quickly and securely">
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        :root {
            --dark-bg: linear-gradient(135deg, #232526 0%, #414345 100%);
            --light-bg: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
            --dark-card: rgba(34, 49, 63, 0.95);
            --light-card: rgba(255, 255, 255, 0.95);
            --dark-text: #dde1e7;
            --light-text: #232526;
        }

        body {
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .dark-mode {
            background: var(--dark-bg);
            color: var(--dark-text);
        }

        .light-mode {
            background: var(--light-bg);
            color: var(--light-text);
        }

        .card {
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border-radius: 1.2rem;
            border: none;
            transition: all 0.3s ease;
        }

        .dark-mode .card {
            background: var(--dark-card);
        }

        .light-mode .card {
            background: var(--light-card);
        }

        .toggle-btn {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 1000;
        }

        .form-control {
            border-radius: 0.8rem;
            padding: 0.8rem 1rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
            border-color: #0d6efd;
        }

        .btn {
            border-radius: 0.8rem;
            padding: 0.8rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #218838, #1fa085);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .loading-spinner {
            display: none;
        }

        .loading .loading-spinner {
            display: inline-block;
        }

        .loading .btn-text {
            display: none;
        }

        .alert {
            border-radius: 0.8rem;
            border: none;
        }

        .status-indicator {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            opacity: 0.7;
        }

        .feature-list {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .feature-list li {
            margin-bottom: 0.3rem;
        }

        @media (max-width: 576px) {
            .container {
                padding: 1rem;
            }
            
            .toggle-btn {
                top: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body class="dark-mode" id="body">
    <!-- Theme Toggle Button -->
    <div class="toggle-btn">
        <button class="btn btn-outline-light btn-sm" onclick="toggleMode()" id="toggleBtn">
            <i class="bi bi-sun"></i> Light
        </button>
    </div>

    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator" title="Service Online"></div>

    <div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
        <div class="row w-100 justify-content-center">
            <div class="col-12 col-md-8 col-lg-6">
                <div class="card p-4 p-md-5">
                    <!-- Header -->
                    <div class="text-center mb-4">
                        <h1 class="display-6 fw-bold mb-2">ðŸ§² MagnetDownloader</h1>
                        <p class="text-muted">Fast, secure magnet link downloads</p>
                    </div>

                    <!-- Download Form -->
                    <form method="post" id="downloadForm">
                        {% csrf_token %}
                        <div class="mb-4">
                            <label for="magnet" class="form-label fw-semibold">
                                Paste your Magnet Link
                            </label>
                            <input 
                                type="text" 
                                class="form-control form-control-lg" 
                                id="magnet" 
                                name="magnet" 
                                required 
                                placeholder="magnet:?xt=urn:btih:..."
                                autocomplete="off"
                            >
                            <div class="form-text">
                                Make sure your magnet link is valid and starts with "magnet:?xt=urn:btih:"
                            </div>
                        </div>

                        <button type="submit" class="btn btn-success btn-lg w-100" id="downloadBtn">
                            <span class="loading-spinner spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            <span class="btn-text">ðŸš€ Download Now</span>
                        </button>
                    </form>

                    <!-- Error Display -->
                    {% if error %}
                        <div class="alert alert-danger mt-3" role="alert">
                            <strong>Error:</strong> {{ error }}
                        </div>
                    {% endif %}

                    <!-- Features -->
                    <div class="mt-4 text-center">
                        <ul class="feature-list list-unstyled">
                            <li>âœ… Direct server-side downloads</li>
                            <li>âœ… No registration required</li>
                            <li>âœ… Fast & secure processing</li>
                            <li>âœ… Automatic file cleanup</li>
                        </ul>
                    </div>

                    <!-- Footer -->
                    <div class="mt-4 text-center">
                        <small class="text-muted">
                            Files are temporarily stored and automatically cleaned up.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Theme Management
        function toggleMode() {
            const body = document.getElementById('body');
            const btn = document.getElementById('toggleBtn');
            
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                btn.classList.remove('btn-outline-light');
                btn.classList.add('btn-outline-dark');
                btn.innerHTML = '<i class="bi bi-moon"></i> Dark';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                btn.classList.remove('btn-outline-dark');
                btn.classList.add('btn-outline-light');
                btn.innerHTML = '<i class="bi bi-sun"></i> Light';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const body = document.getElementById('body');
            const btn = document.getElementById('toggleBtn');
            
            if (savedTheme === 'light') {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                btn.classList.remove('btn-outline-light');
                btn.classList.add('btn-outline-dark');
                btn.innerHTML = '<i class="bi bi-moon"></i> Dark';
            }
        }

        // Form Handling
        document.getElementById('downloadForm').addEventListener('submit', function(e) {
            const btn = document.getElementById('downloadBtn');
            const magnetInput = document.getElementById('magnet');
            const magnetValue = magnetInput.value.trim();
            
            // Basic validation
            if (!magnetValue) {
                e.preventDefault();
                alert('Please enter a magnet link');
                return;
            }
            
            if (!magnetValue.startsWith('magnet:?xt=urn:btih:')) {
                e.preventDefault();
                alert('Please enter a valid magnet link starting with "magnet:?xt=urn:btih:"');
                return;
            }
            
            // Show loading state
            btn.classList.add('loading');
            btn.disabled = true;
            
            // Set timeout to reset button if something goes wrong
            setTimeout(function() {
                btn.classList.remove('loading');
                btn.disabled = false;
            }, 30000); // 30 seconds timeout
        });

        // Status Check
        async function checkStatus() {
            try {
                const response = await fetch('/status/');
                const data = await response.json();
                const indicator = document.getElementById('statusIndicator');
                
                if (data.status === 'ok') {
                    indicator.style.background = '#28a745';
                    indicator.title = 'Service Online - LibTorrent Available';
                } else {
                    indicator.style.background = '#dc3545';
                    indicator.title = 'Service Error - ' + (data.message || 'Unknown error');
                }
            } catch (error) {
                const indicator = document.getElementById('statusIndicator');
                indicator.style.background = '#ffc107';
                indicator.title = 'Connection Error';
            }
        }

        // Magnet Link Validation
        document.getElementById('magnet').addEventListener('input', function(e) {
            const input = e.target;
            const value = input.value.trim();
            
            if (value && !value.startsWith('magnet:?xt=urn:btih:')) {
                input.classList.add('is-invalid');
            } else {
                input.classList.remove('is-invalid');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            checkStatus();
            
            // Check status every 30 seconds
            setInterval(checkStatus, 30000);
        });

        // Handle form errors
        window.addEventListener('load', function() {
            const btn = document.getElementById('downloadBtn');
            btn.classList.remove('loading');
            btn.disabled = false;
        });
    </script>
</body>
</html>
